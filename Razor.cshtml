<!-- Part of Razor -->
@using Newtonsoft.Json

@{    
    var organizations = VP.GetEntitiesData("Organization", "Image.Id,Id,Name,Collections,AddressLine1,PostCode,City,Country.Name,ERPTypes.TypeName,M2,UrlBentley,Lat,Long", "EntityState=Active,IsArchive=false", "Organization=FilterQueryOrga,Theme=FilterQueryTheme,Collection=FilterQueryCollection").OrderBy(obj => obj.Name).ToList();;
    var contacts = VP.GetEntitiesData("OrganizationContact", "Organization.Id,Contact.FullName,Contact.Email,Contact.Job,Contact.Denomination,Contact.LastConnection,Contact.ConnectionsCounter,Contact.MobilePro,Contact.LandlinePro,Contact.AllPhone", "Organization.IsArchive=False,Organization.Entitystate=Active", "Organization=FilterQueryOrga");
    var equipments = VP.GetEntitiesData("Equipment", "Id,Organization.Id,Theme,Reference,QRCode,Brand,EndOfGuarantee", "");
    var equipmentsExtension = VP.GetEntitiesData("ReserveOfVisit", "Organization.Id,Equipments.Id,ReserveStatus,VisitDate", "");
    var equipmentsAction = VP.GetEntitiesData("CActionEquipment", "Organization.Id,Equipment.Id,Status", "", "");
    var lots = VP.GetEntitiesData("Lot", "Organization.Id", "Organization.IsArchive=False,Organization.Entitystate=Active,EntityState=Active", "Organization=FilterQueryOrga");
    var propertyTitles = VP.GetEntitiesData("PropertyTitle", "Id,Organization.Id,Reference,Surface,AcquisitionCost,AcquisitionDate", "Organization.IsArchive=False,Organization.Entitystate=Active,EntityState=Active", "Organization=FilterQueryOrga");
    var owners = VP.GetEntitiesData("Owner", "Id,Organizations.Id,Denomination", "Organizations.IsArchive=False,Organizations.Entitystate=Active,EntityState=Active", "Organization=FilterQueryOrga");
    var baux = VP.GetEntitiesData("Bail", "Id,Reference,Owner.Id,PropertyTitle.Id,BailParent.Id", "Organization.IsArchive=False,Organization.Entitystate=Active,EntityState=Active", "Organization=FilterQueryOrga");
}

<!-- Id,Name,Image.Id,Code,StaffCount,AddressLine1,City,PostCode,Country.Name,AuditDataWorkflowStatus,RPlusFloSurfaceSHONorCount,RMinusFloorCount,IsArchive,EntityState,SurfaceSHON,BuyingDate,VisitLate,ReserveCritTodo,M2,LastRepairDate,ActivitiesAndSector,ModifiedDate -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FIB</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous" />
    <!-- <link rel="stylesheet" href="./style.css" /> -->
</head>

<body>
    <div id="containerFIB">

        <div id="referencesContainer">
            <div class="referencesText">Fiche d'identité du bâtiment > <span class="batimentName"></span></div>
        </div>

        <div id="filtersContainer">
            <div class="allFilters">
                <div class="inline">
                    <label>Site
                        <select name="site" id="siteSelector" class="selector">
                            <option value="default">-- Choisissez un site --</option>
                        </select>
                    </label>
                </div>

                <button id="searchFilterButton">Rechercher</button>
                <button id="rebootFilterButton">Réinitialiser</button>
            </div>
        </div>

        <div id="identityContainer">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSr96vtD0rFIx4JnDPjMZ1Iv3guFaeaEqpxXRtqifUG7bJ58bWd"
                id="identityPicture" />
            <div id="allIdentityInfos">
                <div id="identityIntroContainer">
                    <div>
                        <i class="fas fa-map-marker-alt"></i>
                        <div id="identityTitle" class="smallTitle"><span class="batimentName"></span></div>
                    </div>
                    <div id="identityExport" class="blackButton simpleText">Exporter en PDF</div>
                </div>
                <div id="identityInfosDetails">
                    <div id="identityType" class="simpleText"></div>
                    <div id="identityLocation" class="simpleText">
                        <div id="identityStreetLocation1"></div>
                        <div id="identityStreetLocation2"></div>
                        <div id="identityStreetLocation3"></div>
                        <div id="identityPostCodeLocation"></div><div id="identityCityLocation"></div>
                        <!-- <div id="identityRegionLocation">TEST Région</div> -->
                        <div id="identityCountryLocation"></div>
                    </div>
                    <div id="identityProperties">
                        <div id="identityLabel" class="simpleTitle"></div>
                        <div id="identityFloorsNumber" class="simpleTitle"><div id="identityFloorsNumberData"></div><div class="simpleText">Lots</div></div>
                        <div id="identityTotalSurface" class="simpleTitle"><div id="identityTotalSurfaceData"></div><div class="simpleText">surface totale</div></div>
                        <div id="identityLink3D" class="blackButton simpleText">Lien 3D</div>
                    </div>
                </div>
                <div id="identityGoogleMap"></div>
            </div>
        </div>

        <!-- CONTACT SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-user-alt simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="contactMainData">
                    <div class="mainDataTitle smallTitle">Contact</div>
                    <div class="mainDataSubTitle simpleText">0 contacts référencés</div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData simpleText" id="contactAllData">
                Contacts Référencés
                <div id="contactsReferenced">
                    
                </div>

                <br /><br /><br/>

                Intervenants
                <div id="contactsIntervenant">
                    <!-- ONE CONTACT -->
                    <div class="contactRow">
                        <div class="squareContact">
                            <div class="contactInitial">OA</div>
                        </div>
                        <div class="contactNameAndFunction">
                            <div class="contactName">Otis Ascenseurs</div>
                            <div class="contactFunction">Manager Technique</div>
                        </div>
                        <div class="contactPhonesNumbers">
                            <div><i class="fas fa-phone"></i>06 91 08 10 20</div>
                            <div><i class="fas fa-phone"></i>01 42 02 50 28</div>
                        </div>
                        <div class="contactEmail">
                            <i class="fas fa-envelope"></i>admin@otis.com
                        </div>
                        <div class="contactLog">
                            <div>Dernière connexion le 28/10/2019</div>
                            <div>5 connexions au total</div>
                        </div>
                    </div>

                    <hr class="contactSeparator"/>

                    <!-- ONE CONTACT -->
                    <div class="contactRow">
                        <div class="squareContact">
                            <div class="contactInitial">OA</div>
                        </div>
                        <div class="contactNameAndFunction">
                            <div class="contactName">Otis Ascenseurs</div>
                            <div class="contactFunction">Manager Technique</div>
                        </div>
                        <div class="contactPhonesNumbers">
                            <div><i class="fas fa-phone"></i>06 91 08 10 20</div>
                            <div><i class="fas fa-phone"></i>01 42 02 50 28</div>
                        </div>
                        <div class="contactEmail">
                            <i class="fas fa-envelope"></i>admin@otis.com
                        </div>
                        <div class="contactLog">
                            <div>Dernière connexion le 28/10/2019</div>
                            <div>5 connexions au total</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LEGAL SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-balance-scale simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="legalMainData">
                    <div class="mainDataTitle smallTitle">Juridique</div>
                    <div class="mainDataSubTitle simpleText">
                        <span id="legalNbPropTitles"></span> &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 
                        <span id="legalNbInternalLeases"></span> &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 
                        <span id="legalNbExternalLeases"></span> &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 
                        <span id="legalNbSubLeases"></span> 
                    </div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="legalAllData">
                <div id="legalLegend">
                    <div class="simpleText">
                        <div id="legalLegendSquareIntern" class="legalLegendSquares"></div>Titres de propriété internes
                    </div>
                    <div class="simpleText">
                        <div id="legalLegendSquareExtern" class="legalLegendSquares"></div>Titres de propriété externes
                    </div>
                </div>
                <div id="legalHorTreeTitles">
                    <div class="simpleText">Titres de propriété</div>
                    <div class="simpleText">Baux</div>
                    <div class="simpleText">Sous-Baux</div>
                </div>
                <div id="legalHorTreeContainers"></div>
            </div>
        </div>

        <!-- COMPLIANCE SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-check simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="complianceMainData">
                    <div class="mainDataTitle smallTitle">Conformité</div>
                    <div class="mainDataSubTitle simpleText">80 obligations suivies &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp
                        <span class="redTextColor">4 visites en retard</span> &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp <span
                            class="redTextColor">2 NC critiques à lever</span></div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="complianceAllData">
            </div>
        </div>

        <!-- AUDIT SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-chart-area simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="auditMainData">
                    <div class="mainDataTitle smallTitle">Audit</div>
                    <div class="mainDataSubTitle simpleText">3 audits en cours &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 6 NC à
                        lever</div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="auditAllData">
            </div>
        </div>

        <!-- EQUIPMENTS SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-wrench simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="equipmentsMainData">
                    <div class="mainDataTitle smallTitle">Equipements</div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="equipmentsAllData">
                <main class="tab">
                    <input id="tab1" type="radio" name="tabs" checked>
                    <label for="tab1"><span id="nbEquipments">0</span>Equipements</label>

                    <input id="tab2" type="radio" name="tabs">
                    <label for="tab2"><span>0%</span>Suivi</label>
                        
                    <input id="tab3" type="radio" name="tabs">
                    <label for="tab3"><span id="nbNcToLate">0</span>Non-conformités en retard</label>
                        
                    <input id="tab4" type="radio" name="tabs">
                    <label for="tab4"><span id="nbActionToDo">0</span>Actions à faire</label>

                    <section style="display: block; border-top: 1px solid #ddd;">
                        <div id="equipmentFilters" class="simpleText">
                            <div class="inline verticalAlignMiddle">
                                <label>En fin de garantie dans
                                    <select name="garantie" id="garantieSelector" class="selector">
                                        <option value="">--Choisissez une valeur--</option>
                                    </select>
                                </label>
                            </div>
                            <div class="inline verticalAlignMiddle">
                                <label>Visites prévues dans
                                    <select name="visite" id="visiteSelector" class="selector">
                                        <option value="">--Choisissez une valeur--</option>
                                    </select>
                                </label>
                            </div>
                            <label class="equipmentSwitchFilter verticalAlignMiddle">
                                <label id="equipmentSliderLabel">
                                    <input type="checkbox" checked>
                                    <span class="slider round"></span>
                                Voir les non-conformités</label>
                            </label>
                        </div>
                    </section>

                    <section id="content1">
                        <!-- TODO -->
                        <div class="equipmentTableWrapper">
                            <table id="equipmentFirstTable" class="equipmentTable simpleText">
                                <thead>
                                    <tr>
                                        <th>Thème</th>
                                        <th>Identifiant</th>
                                        <th>QR Code</th>
                                        <th>Marque</th>
                                        <th>Fin de garantie</th>
                                        <th>NC à lever</th>
                                        <th>Prochaine visite</th>
                                        <th>Actions en cours</th>
                                    </tr>
                                </thead>
                                <tbody>
 
                                </tbody>
                            </table>
                        </div>
                    </section>
                        
                    <section id="content2">
                        <p>
                        Bacon ipsum dolor sit amet landjaeger sausage brisket, jerky drumstick fatback boudin ball tip turducken. Pork belly meatball t-bone bresaola tail filet mignon kevin turkey ribeye shank flank doner cow kielbasa shankle. Pig swine chicken hamburger, tenderloin turkey rump ball tip sirloin frankfurter meatloaf boudin brisket ham hock. Hamburger venison brisket tri-tip andouille pork belly ball tip short ribs biltong meatball chuck. Pork chop ribeye tail short ribs, beef hamburger meatball kielbasa rump corned beef porchetta landjaeger flank. Doner rump frankfurter meatball meatloaf, cow kevin pork pork loin venison fatback spare ribs salami beef ribs.
                        </p>
                        <p>
                        Jerky jowl pork chop tongue, kielbasa shank venison. Capicola shank pig ribeye leberkas filet mignon brisket beef kevin tenderloin porchetta. Capicola fatback venison shank kielbasa, drumstick ribeye landjaeger beef kevin tail meatball pastrami prosciutto pancetta. Tail kevin spare ribs ground round ham ham hock brisket shoulder. Corned beef tri-tip leberkas flank sausage ham hock filet mignon beef ribs pancetta turkey.
                        </p>
                    </section>
                        
                    <section id="content3">
                        <!-- TODO -->
                        <div class="equipmentTableWrapper">
                            <table id="equipmentThirdTable" class="equipmentTable simpleText">
                                <thead>
                                    <tr>
                                        <th>Thème</th>
                                        <th>Identifiant</th>
                                        <th>QR Code</th>
                                        <th>Marque</th>
                                        <th>Fin de garantie</th>
                                        <th>NC en retard</th>
                                        <th>Prochaine visite</th>
                                        <th>Actions en cours</th>
                                    </tr>
                                </thead>
                                <tbody>
 
                                </tbody>
                            </table>
                        </div>
                    </section>
                        
                    <section id="content4">
                        <div class="equipmentTableWrapper">
                            <table id="equipmentFourthTable" class="equipmentTable simpleText">
                                <thead>
                                    <tr>
                                        <th>Thème</th>
                                        <th>Identifiant</th>
                                        <th>QR Code</th>
                                        <th>Marque</th>
                                        <th>Fin de garantie</th>
                                        <th>NC à lever</th>
                                        <th>Prochaine visite</th>
                                        <th>Actions à faire</th>
                                    </tr>
                                </thead>
                                <tbody>
 
                                </tbody>
                            </table>
                        </div>
                    </section>                     
                </main>
            </div>
        </div>

        <!-- DATA COLLECTION SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-sd-card simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="dataCollectionMainData">
                    <div class="mainDataTitle smallTitle">Collecte de données</div>
                    <div class="mainDataSubTitle simpleText">4 campagnes en cours &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp
                        <span class="redTextColor">23% de complétion</span></div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="dataCollectionAllData">
            </div>
        </div>

        <!-- INCIDENTS SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-exclamation-triangle simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="incidentsMainData">
                    <div class="mainDataTitle smallTitle">Incidents</div>
                    <div class="mainDataSubTitle simpleText">23 incidents &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 11
                        presque-accidents &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 4 accidents</div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="incidentsAllData">
            </div>
        </div>

        <!-- SCHEMA DIRECTORY SECTION -->
        <div class="sectionContainer">
            <div class="primaryInfos">
                <i class="fas fa-rocket simpleTitle verticalAlignMiddle"></i>
                <div class="mainData" id="schemaDirectoryMainData">
                    <div class="mainDataTitle smallTitle">Schéma directeur</div>
                    <div class="mainDataSubTitle simpleText">4 plans quinquénnaux &nbsp&nbsp&nbsp / &nbsp&nbsp&nbsp 12
                        actions en retard</div>
                </div>
                <i class="fas fa-plus openCloseIcon"></i>
            </div>
            <div class="allData" id="schemaDirectoryAllData">
            </div>
        </div>

    </div>
</body>

</html>
    
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
    integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
    crossorigin="anonymous">
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous">
</script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous">
</script>
<!-- <script src="./horizontalTreePlugin/dist/jquery.hortree.min.js"></script> -->
<!-- <script src="./horizontalTreePlugin/demo/jquery.line.js"></script> -->

<script>

let jsonAllOrganizations = JSON.parse(('@JsonConvert.SerializeObject(organizations)').replace(/&quot;/g, '"'));
let jsonAllContacts = JSON.parse(('@JsonConvert.SerializeObject(contacts)').replace(/&quot;/g, '"'));
let jsonAllEquipments = JSON.parse(('@JsonConvert.SerializeObject(equipments)').replace(/&quot;/g, '"'));
let jsonAllEquipmentsExtension = JSON.parse(('@JsonConvert.SerializeObject(equipmentsExtension)').replace(/&quot;/g, '"'));
let jsonAllEquipmentsAction = JSON.parse(('@JsonConvert.SerializeObject(equipmentsAction)').replace(/&quot;/g, '"'));
let jsonAllLots = JSON.parse(('@JsonConvert.SerializeObject(lots)').replace(/&quot;/g, '"'));
let jsonAllPropertyTitles = JSON.parse(('@JsonConvert.SerializeObject(propertyTitles)').replace(/&quot;/g, '"'));
let jsonAllOwners = JSON.parse(('@JsonConvert.SerializeObject(owners)').replace(/&quot;/g, '"'));
let jsonAllBaux = JSON.parse(('@JsonConvert.SerializeObject(baux)').replace(/&quot;/g, '"'));

function initFIBGoogleMap() {
  // La map est crée grâce à l'API de Google Maps :
  var identityGoogleMap = new google.maps.Map(document.getElementById('identityGoogleMap'), {
    center: new google.maps.LatLng(40, 0),
    zoom: 2,
    disableDefaultUI: true,
  	styles: [
  		{
			"elementType": "geometry",
  			"stylers": [
          		{ "visibility": "simplified" },
  		  		{ "hue": "#00aec7" },
          		{ "saturation": -50 }
        	]
      	}
    ]
  });

  return identityGoogleMap;
}

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCKL92_ats3EIcnsjjSjxp5UgZseR6lnIY&libraries=places&sensor=false&callback=initFIBGoogleMap"></script>
<!-- <script src="./script.js"></script> -->